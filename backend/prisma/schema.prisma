// Minimal Prisma schema for SQLite demo
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id                String   @id @default(cuid())
  email             String   @unique
  passwordHash      String?
  firstName         String
  lastName          String
  role              String   @default("USER") // USER, VENDOR, ADMIN
  status            String   @default("PENDING_VERIFICATION") // ACTIVE, INACTIVE, SUSPENDED, PENDING_VERIFICATION
  emailVerified     Boolean  @default(false)
  emailVerificationToken String?
  passwordResetToken String?
  lastLogin         DateTime?
  loginAttempts     Int      @default(0)
  
  // OAuth fields
  googleId          String?  @unique
  microsoftId       String?  @unique
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relationships
  profile           Profile?
  vendor            Vendor?
  posts             Post[]
  comments          Comment[]
  surveyResponses   SurveyResponse[]
  notifications     Notification[]
  sessions          Session[]
  
  @@map("users")
}

model Profile {
  id                String   @id @default(cuid())
  userId            String   @unique
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  bio               String?
  phone             String?
  country           String?
  city              String?
  jobTitle          String?
  company           String?
  industry          String?
  experienceYears   Int?
  website           String?
  linkedin          String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("profiles")
}

// Vendor System
model Vendor {
  id                String   @id @default(cuid())
  userId            String?  @unique
  user              User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  companyName       String
  businessName      String
  description       String
  email             String
  phone             String?
  address           String?
  city              String?
  state             String?
  country           String?
  postalCode        String?
  
  businessType      String
  yearEstablished   Int?
  employeeCount     String?
  website           String?
  
  status            String   @default("PENDING_APPROVAL") // ACTIVE, INACTIVE, SUSPENDED, PENDING_APPROVAL
  averageRating     Float    @default(0)
  totalReviews      Int      @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relationships
  services          VendorService[]
  reviews           Review[]
  
  @@map("vendors")
}

model VendorService {
  id                String   @id @default(cuid())
  vendorId          String
  vendor            Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  
  name              String
  description       String
  category          String
  subcategory       String?
  
  basePrice         Float?
  priceUnit         String?
  duration          String?
  
  isActive          Boolean  @default(true)
  isFeatured        Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("vendor_services")
}

model Review {
  id                String   @id @default(cuid())
  vendorId          String
  vendor            Vendor   @relation(fields: [vendorId], references: [id], onDelete: Cascade)
  
  reviewerName      String
  reviewerEmail     String
  title             String
  content           String
  
  overallRating     Int
  qualityRating     Int?
  communicationRating Int?
  timelinessRating  Int?
  valueRating       Int?
  
  status            String   @default("PENDING")
  isVerified        Boolean  @default(false)
  isPublic          Boolean  @default(true)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("reviews")
}

// Community Platform
model Category {
  id                String   @id @default(cuid())
  name              String   @unique
  slug              String   @unique
  description       String?
  color             String?
  icon              String?
  
  isActive          Boolean  @default(true)
  postCount         Int      @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  posts             Post[]
  
  @@map("categories")
}

model Post {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title             String
  content           String
  type              String   @default("ARTICLE") // ARTICLE, QUESTION, DISCUSSION, ANNOUNCEMENT
  status            String   @default("DRAFT") // DRAFT, PUBLISHED, ARCHIVED
  
  featuredImageUrl  String?
  slug              String   @unique
  metaDescription   String?
  tags              String?
  
  categoryId        String?
  category          Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  
  viewCount         Int      @default(0)
  likeCount         Int      @default(0)
  commentCount      Int      @default(0)
  
  publishedAt       DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  comments          Comment[]
  
  @@map("posts")
}

model Comment {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  postId            String?
  post              Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  parentId          String?
  parent            Comment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies           Comment[] @relation("CommentReplies")
  
  content           String
  status            String   @default("PUBLISHED")
  likeCount         Int      @default(0)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("comments")
}

// AI Readiness
model Survey {
  id                String   @id @default(cuid())
  title             String
  description       String?
  version           String   @default("1.0")
  
  status            String   @default("DRAFT") // DRAFT, ACTIVE, PAUSED, COMPLETED, ARCHIVED
  timeLimit         Int?
  maxAttempts       Int?
  passingScore      Int?
  
  isPublic          Boolean  @default(false)
  category          String?
  
  totalResponses    Int      @default(0)
  averageScore      Float?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  publishedAt       DateTime?
  
  questions         Question[]
  responses         SurveyResponse[]
  
  @@map("surveys")
}

model Question {
  id                String   @id @default(cuid())
  surveyId          String
  survey            Survey   @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  
  text              String
  description       String?
  type              String   // SINGLE_CHOICE, MULTIPLE_CHOICE, TEXT, etc.
  
  options           String?
  isRequired        Boolean  @default(false)
  order             Int
  
  maxScore          Int      @default(1)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  responses         QuestionResponse[]
  
  @@map("questions")
}

model SurveyResponse {
  id                String   @id @default(cuid())
  surveyId          String
  survey            Survey   @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  userId            String?
  user              User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  status            String   @default("in_progress") // in_progress, completed, abandoned
  startedAt         DateTime @default(now())
  completedAt       DateTime?
  timeSpent         Int?
  
  totalScore        Int      @default(0)
  maxScore          Int      @default(0)
  percentage        Float?
  
  deviceInfo        String?
  feedback          String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  questionResponses QuestionResponse[]
  
  @@map("survey_responses")
}

model QuestionResponse {
  id                String   @id @default(cuid())
  questionId        String
  question          Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  
  responseId        String
  response          SurveyResponse @relation(fields: [responseId], references: [id], onDelete: Cascade)
  
  answer            String
  score             Int      @default(0)
  
  timeSpent         Int?
  createdAt         DateTime @default(now())
  
  @@unique([questionId, responseId])
  @@map("question_responses")
}

// Admin System
model PlatformSetting {
  id                String   @id @default(cuid())
  key               String   @unique
  value             String
  description       String?
  category          String
  isPublic          Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("platform_settings")
}

model AnalyticsEvent {
  id                String   @id @default(cuid())
  eventType         String
  eventName         String
  
  data              String
  userId            String?
  
  page              String?
  url               String?
  referrer          String?
  ipAddress         String?
  
  duration          Int?
  createdAt         DateTime @default(now())
  
  @@map("analytics_events")
}

// Session Management
model Session {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  token             String   @unique
  refreshToken      String   @unique
  
  deviceInfo        String?
  ipAddress         String?
  userAgent         String?
  
  expiresAt         DateTime
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("sessions")
}

// Communication
model Notification {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title             String
  message           String
  type              String   @default("IN_APP") // EMAIL, IN_APP, PUSH
  
  data              String?
  actionUrl         String?
  
  isRead            Boolean  @default(false)
  isArchived        Boolean  @default(false)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  @@map("notifications")
}